<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Disc of Serendipity</title>
	</head>
	<body>
		<h1>Disc of Serendipity</h1>
		<canvas id="dos" width="250" height="250"></canvas>
		<button type="button" name="button" onclick="spin();">Spin</button>
<script src="assets/js/wheel_physics.js" charset="utf-8"></script>
<script src="assets/js/wheel_draw.js" charset="utf-8"></script>
<script type="text/javascript">
	var canvas = document.getElementById("dos");
	var ctx = canvas.getContext("2d");

	var wheelCanvas = newWheelCanvas();
	ctx.translate(canvas.width/2, canvas.height/2);

	var wp = new WheelPhysics(0);
	var wheelAnimationStart;
	var wheelIsSpinning = false;
	function renderWheelAnimation() {
		canvas.width = canvas.width;
		ctx.translate(canvas.width/2, canvas.height/2);
		drawWheel(ctx, wheelCanvas, wp.theta);
		var delta = Date.now() - wheelAnimationStart;
		wp.step(delta / 1000);
		wheelAnimationStart = Date.now();
		if (Math.abs(wp.omega) > 0.01) {
			requestAnimationFrame(renderWheelAnimation);
		} else {
			wheelIsSpinning = false;
		}
	}

	function spin() {
		if (!wheelIsSpinning) {
			wheelIsSpinning = true;
			wp.omega = Math.random()*4 + 4;
			wheelAnimationStart = Date.now();
			renderWheelAnimation();
		}
	}

	drawWheel(ctx, wheelCanvas, wp.theta);

</script>
	</body>
</html>
